<!doctype html>
<html>
<head>
    <title>Multiplayer Game</title>
    <LINK REL="SHORTCUT ICON" HREF="favicon.ico">
    <style>
        .quad {
            background-color: #ddcf00;
            height: 50px;
            width: 50px;
            position: absolute;
            margin-top: 111px;
            margin-left: 111px;
        }
    </style>
</head>

<body>

<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script>
    var socket = io();
    var currentNumber;



    // Daten, die nur diesem Client nach der Anmeldung beim Server geschickt werden
    socket.on('drawExistingPlayers', function (data) {
        currentNumber = data.currentNumber;
        console.log("All Data:  " + JSON.stringify(data));
        console.log("allPlayers.currentNumber:  " + JSON.stringify(data.currentNumber));
        console.log("allPlayers.clientColors:  " + JSON.stringify(data.clientColors));
        console.log("allPlayers.posX:  " + JSON.stringify(data.posX));
        console.log("allPlayers.posY:  " + JSON.stringify(data.posY));


        for (var i = 0; i < currentNumber; i++) {
            createNewPlayer(i, data.posX[i], data.posY[i], data.clientColors[i])
        }
    });

    // Bei JEDEM Client wird ein neues Quadrat gezeichnet
    socket.on('drawNewPlayer', function (data) {
        console.log("New Data:  " + JSON.stringify(data));
        createNewPlayer(currentNumber, data.new_posX, data.new_posY, data.new_color);
    });

    // Bei einem Mausklick die Position an den Server senden.
    // Dieser sendet die Koordinaten an alle verbundenen Clients weiter

    document.addEventListener("click", printMousePos);

    function printMousePos(e) {
        var newPosition = {
            client_id: currentNumber,
            posX: e.clientX,
            posY: e.clientY
        };

        socket.emit("newPosition", newPosition)
    }
    socket.on('newPosition', function (data) {
        console.log("Position Click: " + JSON.stringify(data));
        var client_id = document.getElementById(data.client_id);
        $(client_id).css("margin-left", data.posX + "px");
        $(client_id).css("margin-top", data.posY + "px");
//        client_id.style.marginLeft = data.posX + "px";
//        client_id.style.marginTop = data.posY + "px";
    });


    function createNewPlayer(id, x, y, color) {
        var newQuad = document.createElement('div');
        document.body.appendChild(newQuad);
        newQuad.setAttribute("id", id);
        newQuad.setAttribute("class", "quad");
        newQuad.style.marginLeft = x + "px";
        newQuad.style.marginTop = y + "px";
        newQuad.style.backgroundColor = color;
    }
</script>
</body>
</html>




