<!--index.html-->

<!doctype html>
<html>
<head>
    <title>Multiplayer Game</title>
    <link rel="shortcut icon" href="../img/favicon.ico">
    <style>
        .quad {
            background-color: #ddcf00;
            height: 50px;
            width: 50px;
            position: absolute;
            margin-top: 111px;
            margin-left: 111px;
        }
    </style>
</head>

<body>

<script src="/socket.io/socket.io.js"></script>
<script src="../js/jquery-1.11.1.js"></script>
<!--<script src="http://code.jquery.com/jquery-1.11.1.js"></script>-->
<script>
    var socket = io();
    var client_ip;
    var clientID_isSet = false;

    socket.on("doubleConnection", function (data) {
        alert(data);
    });

    /**
     * 1. When this client connects to the server, it gets the data of all existing clients
     * and draws a quad for each of them
     */

    socket.on('drawExistingPlayers', function (data) {
        console.log("All existing players:  " + JSON.stringify(data));

        for (var key in data) {
            createNewPlayer(key, data[key].posX, data[key].posY, data[key].clientColor);
        }
    });

    /**
     * 2. Then every connected client gets the data of the new client
     * and draws a new quad for it
     */

    socket.on('drawNewPlayer', function (data) {
        console.log("One new player:  " + JSON.stringify(data));

        if (clientID_isSet == false) {
            client_ip = data.key;
            clientID_isSet=true;
        }
        createNewPlayer(data.key, data.val.posX, data.val.posY, data.val.clientColor);
    });

    /**
     * 3. When one client changes the position of its quad, it will be redrawed on each client.
     */

    document.addEventListener("click", function (e) {
        var newPosition = {
            client_ip: client_ip,
            posX: e.clientX,
            posY: e.clientY
        };
        socket.emit("newPosition", newPosition)
    });

    socket.on('newPosition', function (data) {
        console.log("Position Click: " + JSON.stringify(data));
        document.getElementById(data.client_ip).style.marginLeft = data.posX + "px";
        document.getElementById(data.client_ip).style.marginTop = data.posY + "px";
    });

    function createNewPlayer(id, x, y, color) {
        var newQuad = document.createElement('div');
        document.body.appendChild(newQuad);
        newQuad.setAttribute("id", id);
        newQuad.setAttribute("class", "quad");
        newQuad.style.marginLeft = x + "px";
        newQuad.style.marginTop = y + "px";
        newQuad.style.backgroundColor = color;
    }

</script>
</body>
</html>